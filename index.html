<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÉÄ„É≥„ÇπÁ∑¥Áøí„Ç¢„Éó„É™Ôºà„Ç´„É°„É©„É≠„Éº„É´ÂØæÂøúÁâàÔºâ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        * {
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // SVG„Ç¢„Ç§„Ç≥„É≥
        const Upload = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Play = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const Pause = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        );

        const RotateCcw = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        );

        const Smartphone = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                <line x1="12" y1="18" x2="12.01" y2="18"></line>
            </svg>
        );

        const Wifi = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                <line x1="12" y1="20" x2="12.01" y2="20"></line>
            </svg>
        );

        const Camera = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </svg>
        );

        const Maximize = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
            </svg>
        );

        const Film = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect>
                <line x1="7" y1="2" x2="7" y2="22"></line>
                <line x1="17" y1="2" x2="17" y2="22"></line>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <line x1="2" y1="7" x2="7" y2="7"></line>
                <line x1="2" y1="17" x2="7" y2="17"></line>
                <line x1="17" y1="17" x2="22" y2="17"></line>
                <line x1="17" y1="7" x2="22" y2="7"></line>
            </svg>
        );

        const DancePracticeApp = () => {
            const [mode, setMode] = useState('select');
            const [roomCode, setRoomCode] = useState('');
            const [inputRoomCode, setInputRoomCode] = useState('');
            const [videoFile, setVideoFile] = useState(null);
            const [videoUrl, setVideoUrl] = useState('');
            const [isPlaying, setIsPlaying] = useState(false);
            const [connectionError, setConnectionError] = useState('');
            const [cameraConnected, setCameraConnected] = useState(false);
            const [showDisplay, setShowDisplay] = useState(false);
            
            const videoRef = useRef(null);
            const displayVideoRef = useRef(null);
            const cameraVideoRef = useRef(null);
            const canvasRef = useRef(null);
            const streamIntervalRef = useRef(null);

            // BroadcastChannelÈÄö‰ø°
            useEffect(() => {
                if (roomCode && (mode === 'main' || mode === 'camera')) {
                    const channel = new BroadcastChannel(`dance-app-${roomCode}`);
                    
                    channel.onmessage = (event) => {
                        const data = event.data;
                        handleMessage(data);
                    };

                    const handleStorageChange = (e) => {
                        if (e.key === `dance-app-${roomCode}`) {
                            try {
                                const data = JSON.parse(e.newValue);
                                handleMessage(data);
                            } catch (err) {
                                console.error('Parse error:', err);
                            }
                        }
                    };

                    window.addEventListener('storage', handleStorageChange);
                    
                    return () => {
                        channel.close();
                        window.removeEventListener('storage', handleStorageChange);
                    };
                }
            }, [mode, roomCode]);

            const sendMessage = (data) => {
                const message = { ...data, roomCode, timestamp: Date.now() };
                
                try {
                    const channel = new BroadcastChannel(`dance-app-${roomCode}`);
                    channel.postMessage(message);
                    channel.close();
                } catch (err) {
                    console.error('BroadcastChannel error:', err);
                }
                
                try {
                    localStorage.setItem(`dance-app-${roomCode}`, JSON.stringify(message));
                } catch (err) {
                    console.error('localStorage error:', err);
                }
            };

            const handleMessage = (data) => {
                if (!data) return;
                
                if (data.type === 'play') {
                    setIsPlaying(true);
                    if (videoRef.current && videoRef.current.src) {
                        videoRef.current.play().catch(e => console.log('ÂÜçÁîü„Ç®„É©„Éº:', e));
                    }
                    if (displayVideoRef.current && displayVideoRef.current.src) {
                        displayVideoRef.current.play().catch(e => console.log('ÂÜçÁîü„Ç®„É©„Éº:', e));
                    }
                } else if (data.type === 'pause') {
                    setIsPlaying(false);
                    if (videoRef.current) {
                        videoRef.current.pause();
                    }
                    if (displayVideoRef.current) {
                        displayVideoRef.current.pause();
                    }
                } else if (data.type === 'reset') {
                    setIsPlaying(false);
                    if (videoRef.current) {
                        videoRef.current.currentTime = 0;
                        videoRef.current.pause();
                    }
                    if (displayVideoRef.current) {
                        displayVideoRef.current.currentTime = 0;
                        displayVideoRef.current.pause();
                    }
                } else if (data.type === 'seek' && data.time !== undefined) {
                    if (videoRef.current) {
                        videoRef.current.currentTime = data.time;
                    }
                    if (displayVideoRef.current) {
                        displayVideoRef.current.currentTime = data.time;
                    }
                } else if (data.type === 'connect-camera') {
                    setCameraConnected(true);
                } else if (data.type === 'camera-frame' && data.frame) {
                    if (canvasRef.current) {
                        const img = new Image();
                        img.onload = () => {
                            const ctx = canvasRef.current.getContext('2d');
                            canvasRef.current.width = img.width;
                            canvasRef.current.height = img.height;
                            ctx.save();
                            ctx.scale(-1, 1);
                            ctx.drawImage(img, -img.width, 0, img.width, img.height);
                            ctx.restore();
                        };
                        img.src = data.frame;
                    }
                }
            };

            const generateRoomCode = () => {
                return Math.random().toString(36).substring(2, 8).toUpperCase();
            };

            const startMain = () => {
                const code = generateRoomCode();
                setRoomCode(code);
                setMode('main');
            };

            const startCamera = () => {
                setMode('camera-input');
            };

            const connectToRoomAsCamera = () => {
                const code = inputRoomCode.trim().toUpperCase();
                if (code.length === 6) {
                    setRoomCode(code);
                    setMode('camera');
                    sendMessage({ type: 'connect-camera' });
                    setConnectionError('');
                } else {
                    setConnectionError('6ÊñáÂ≠ó„ÅÆ„É´„Éº„É†„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                }
            };

            const handleVideoSelect = (e) => {
                const file = e.target.files[0];
                if (file && file.type.startsWith('video/')) {
                    setVideoFile(file);
                    const url = URL.createObjectURL(file);
                    setVideoUrl(url);
                }
            };

            const togglePlay = () => {
                if (isPlaying) {
                    sendMessage({ type: 'pause' });
                    if (videoRef.current) {
                        videoRef.current.pause();
                    }
                    if (displayVideoRef.current) {
                        displayVideoRef.current.pause();
                    }
                    setIsPlaying(false);
                } else {
                    sendMessage({ type: 'play' });
                    if (videoRef.current && videoRef.current.src) {
                        videoRef.current.play().catch(e => console.log('ÂÜçÁîü„Ç®„É©„Éº:', e));
                    }
                    if (displayVideoRef.current && displayVideoRef.current.src) {
                        displayVideoRef.current.play().catch(e => console.log('ÂÜçÁîü„Ç®„É©„Éº:', e));
                    }
                    setIsPlaying(true);
                }
            };

            const resetVideo = () => {
                sendMessage({ type: 'reset' });
                if (videoRef.current) {
                    videoRef.current.currentTime = 0;
                    videoRef.current.pause();
                }
                if (displayVideoRef.current) {
                    displayVideoRef.current.currentTime = 0;
                    displayVideoRef.current.pause();
                }
                setIsPlaying(false);
            };

            const toggleDisplay = () => {
                setShowDisplay(!showDisplay);
            };

            // ÂãïÁîª„ÅÆÂêåÊúüÔºà„Ç≥„É≥„Éà„É≠„Éº„É©„ÉºÂÅ¥„ÅÆÂãïÁîª„Å®„Éá„Ç£„Çπ„Éó„É¨„Ç§ÂÅ¥„ÅÆÂãïÁîª„ÇíÂêåÊúüÔºâ
            useEffect(() => {
                if (videoRef.current && !showDisplay) {
                    const handleTimeUpdate = () => {
                        // ÊôÇÈñì„ÅÆÂêåÊúü„ÅØ„É™„Ç¢„É´„Çø„Ç§„É†„Å´„ÅØË°å„Çè„Å™„ÅÑÔºàË≤†Ëç∑ËªΩÊ∏õÔºâ
                    };
                    
                    videoRef.current.addEventListener('timeupdate', handleTimeUpdate);
                    
                    return () => {
                        if (videoRef.current) {
                            videoRef.current.removeEventListener('timeupdate', handleTimeUpdate);
                        }
                    };
                }
            }, [showDisplay]);

            // „Ç´„É°„É©Êò†ÂÉèÈÄÅ‰ø°
            useEffect(() => {
                if (mode === 'camera' && cameraVideoRef.current && roomCode) {
                    navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            facingMode: 'user',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        } 
                    })
                    .then(stream => {
                        cameraVideoRef.current.srcObject = stream;
                        
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        streamIntervalRef.current = setInterval(() => {
                            if (cameraVideoRef.current && cameraVideoRef.current.readyState === cameraVideoRef.current.HAVE_ENOUGH_DATA) {
                                canvas.width = cameraVideoRef.current.videoWidth;
                                canvas.height = cameraVideoRef.current.videoHeight;
                                ctx.drawImage(cameraVideoRef.current, 0, 0);
                                
                                const frame = canvas.toDataURL('image/jpeg', 0.4);
                                sendMessage({ type: 'camera-frame', frame });
                            }
                        }, 250);
                    })
                    .catch(err => {
                        console.error('„Ç´„É°„É©„Ç¢„ÇØ„Çª„Çπ„Ç®„É©„Éº:', err);
                        alert('„Ç´„É°„É©„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÇíË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇË®≠ÂÆö„Åã„Çâ„Ç´„É°„É©„ÅÆÊ®©Èôê„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    });

                    return () => {
                        if (streamIntervalRef.current) {
                            clearInterval(streamIntervalRef.current);
                        }
                        if (cameraVideoRef.current && cameraVideoRef.current.srcObject) {
                            cameraVideoRef.current.srcObject.getTracks().forEach(track => track.stop());
                        }
                    };
                }
            }, [mode, roomCode]);

            // „É¢„Éº„ÉâÈÅ∏ÊäûÁîªÈù¢
            if (mode === 'select') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
                            <div className="text-center mb-8">
                                <h1 className="text-4xl font-bold text-gray-800 mb-2">üï∫ „ÉÄ„É≥„ÇπÁ∑¥Áøí</h1>
                                <p className="text-gray-600 mb-1">„Ç´„É°„É©„É≠„Éº„É´ÂØæÂøúÁâà</p>
                                <p className="text-sm text-gray-500">ÂãïÁîª„Çµ„Ç§„Ç∫Âà∂Èôê„Å™„ÅóÔºÅ</p>
                            </div>
                            
                            <div className="space-y-4">
                                <button
                                    onClick={startMain}
                                    className="w-full bg-blue-500 hover:bg-blue-600 text-white rounded-xl p-6 flex items-center justify-between transition-all transform hover:scale-105"
                                >
                                    <div className="flex items-center gap-4">
                                        <div className="w-8 h-8"><Smartphone /></div>
                                        <div className="text-left">
                                            <div className="font-bold text-lg">üì± „Çπ„Éû„ÉõA</div>
                                            <div className="text-sm opacity-90">Êìç‰Ωú + Ë°®Á§∫ÔºàAirPlay„Åß„ÉÜ„É¨„Éì„Å∏Ôºâ</div>
                                        </div>
                                    </div>
                                    <div className="text-2xl">‚Üí</div>
                                </button>

                                <button
                                    onClick={startCamera}
                                    className="w-full bg-pink-500 hover:bg-pink-600 text-white rounded-xl p-6 flex items-center justify-between transition-all transform hover:scale-105"
                                >
                                    <div className="flex items-center gap-4">
                                        <div className="w-8 h-8"><Camera /></div>
                                        <div className="text-left">
                                            <div className="font-bold text-lg">üì± „Çπ„Éû„ÉõB</div>
                                            <div className="text-sm opacity-90">„Ç´„É°„É©ÔºàÊíÆÂΩ±Áî®Ôºâ</div>
                                        </div>
                                    </div>
                                    <div className="text-2xl">‚Üí</div>
                                </button>
                            </div>

                            <div className="mt-8 pt-6 border-t border-gray-200 space-y-3">
                                <div className="bg-green-50 border border-green-200 rounded-xl p-3 text-xs text-gray-700">
                                    <strong>‚úÖ Êñ∞Ê©üËÉΩ:</strong><br/>
                                    „Ç´„É°„É©„É≠„Éº„É´„Åã„ÇâÁõ¥Êé•ÂãïÁîª„ÇíÈÅ∏ÊäûÔºÅ<br/>
                                    „Çµ„Ç§„Ç∫Âà∂Èôê„Å™„Åó„ÄÅ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏çË¶Å
                                </div>
                                <div className="bg-blue-50 border border-blue-200 rounded-xl p-3 text-xs text-gray-700">
                                    <strong>üí° ‰Ωø„ÅÑÊñπ:</strong><br/>
                                    1. „Çπ„Éû„ÉõA„ÅßÂãïÁîª„ÇíÈÅ∏Êäû<br/>
                                    2. AirPlay„Åß„ÉÜ„É¨„Éì„Å´Êò†„Åô<br/>
                                    3. „Çπ„Éû„ÉõB„Åß„Ç´„É°„É©ÊíÆÂΩ±
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // „É°„Ç§„É≥ÁîªÈù¢Ôºà„Ç≥„É≥„Éà„É≠„Éº„É©„Éº + „Éá„Ç£„Çπ„Éó„É¨„Ç§Ôºâ
            if (mode === 'main') {
                if (showDisplay) {
                    // „Éï„É´„Çπ„ÇØ„É™„Éº„É≥Ë°®Á§∫„É¢„Éº„ÉâÔºàAirPlayÁî®Ôºâ
                    return (
                        <div className="min-h-screen bg-black flex">
                            {/* Â∑¶ÂçäÂàÜ: Ë¶ãÊú¨ÂãïÁîª */}
                            <div className="w-1/2 bg-gray-900 flex items-center justify-center relative">
                                {videoUrl ? (
                                    <div className="w-full h-full flex items-center justify-center">
                                        <video
                                            ref={displayVideoRef}
                                            src={videoUrl}
                                            className="max-w-full max-h-full"
                                            loop
                                            playsInline
                                        />
                                        <div className="absolute top-6 left-6 bg-purple-500 text-white px-6 py-3 rounded-full font-bold text-xl shadow-lg">
                                            üë®‚Äçüè´ Ë¶ãÊú¨
                                        </div>
                                    </div>
                                ) : (
                                    <div className="text-center text-white px-4">
                                        <div className="w-24 h-24 mx-auto mb-4 opacity-50"><Film /></div>
                                        <p className="text-2xl">ÂãïÁîª„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                    </div>
                                )}
                            </div>

                            {/* Âè≥ÂçäÂàÜ: „Ç´„É°„É©Êò†ÂÉè */}
                            <div className="w-1/2 bg-black flex items-center justify-center relative">
                                <canvas
                                    ref={canvasRef}
                                    className="w-full h-full object-cover"
                                />
                                {!cameraConnected && (
                                    <div className="absolute inset-0 flex items-center justify-center">
                                        <div className="text-center text-white px-4">
                                            <div className="w-24 h-24 mx-auto mb-4 opacity-50"><Camera /></div>
                                            <p className="text-2xl mb-2">„Çπ„Éû„ÉõB„Çí„Ç´„É°„É©„Å®„Åó„Å¶Êé•Á∂ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                            <p className="text-sm text-gray-400">„É´„Éº„É†„Ç≥„Éº„Éâ: {roomCode}</p>
                                        </div>
                                    </div>
                                )}
                                <div className="absolute top-6 right-6 bg-pink-500 text-white px-6 py-3 rounded-full font-bold text-xl shadow-lg">
                                    üé• „ÅÇ„Å™„Åü
                                </div>
                                {cameraConnected && (
                                    <div className="absolute bottom-6 right-6 flex items-center gap-3 bg-black/70 text-white px-4 py-2 rounded-full">
                                        <div className="w-5 h-5"><Camera /></div>
                                        <span className="text-sm">„Çπ„Éû„ÉõBÊé•Á∂ö‰∏≠</span>
                                    </div>
                                )}
                                {/* Êàª„Çã„Éú„Çø„É≥ */}
                                <button
                                    onClick={toggleDisplay}
                                    className="absolute top-6 left-6 bg-gray-700/80 hover:bg-gray-600 text-white p-3 rounded-full"
                                >
                                    ‚úï
                                </button>
                            </div>
                        </div>
                    );
                }

                // „Ç≥„É≥„Éà„É≠„Éº„É©„Éº„É¢„Éº„Éâ
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-500 to-cyan-500 p-4">
                        <div className="max-w-md mx-auto">
                            <div className="bg-white rounded-3xl shadow-2xl p-6 mb-4">
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-2xl font-bold text-gray-800">üì± „Çπ„Éû„ÉõA</h2>
                                    <button
                                        onClick={() => setMode('select')}
                                        className="text-gray-500 hover:text-gray-700 text-2xl"
                                    >
                                        ‚úï
                                    </button>
                                </div>

                                <div className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl p-6 mb-6">
                                    <div className="text-center">
                                        <div className="text-sm text-gray-600 mb-2">„É´„Éº„É†„Ç≥„Éº„Éâ</div>
                                        <div className="text-4xl font-bold text-purple-700 tracking-widest mb-2">
                                            {roomCode}
                                        </div>
                                        <div className="text-xs text-gray-600">
                                            „Çπ„Éû„ÉõB„Åß„Åì„ÅÆ„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ
                                        </div>
                                    </div>
                                </div>

                                {!videoFile ? (
                                    <div className="border-4 border-dashed border-gray-300 rounded-2xl p-8 text-center mb-4">
                                        <div className="w-16 h-16 mx-auto mb-4 text-gray-400"><Film /></div>
                                        <p className="text-gray-600 mb-2">„Ç´„É°„É©„É≠„Éº„É´„Åã„ÇâÂãïÁîª„ÇíÈÅ∏Êäû</p>
                                        <p className="text-xs text-green-600 mb-4">‚úÖ „Çµ„Ç§„Ç∫Âà∂Èôê„Å™„ÅóÔºÅ</p>
                                        <label className="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-xl cursor-pointer inline-block transition-all transform hover:scale-105">
                                            ÂãïÁîª„ÇíÈÅ∏Êäû
                                            <input
                                                type="file"
                                                accept="video/*"
                                                onChange={handleVideoSelect}
                                                className="hidden"
                                            />
                                        </label>
                                    </div>
                                ) : (
                                    <div>
                                        <div className="bg-gray-100 rounded-2xl p-4 mb-4">
                                            <div className="flex items-center gap-3 mb-3">
                                                <div className="w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center">
                                                    <div className="w-6 h-6 text-white"><Film /></div>
                                                </div>
                                                <div className="flex-1">
                                                    <div className="font-semibold text-gray-800">
                                                        {videoFile.name}
                                                    </div>
                                                    <div className="text-sm text-gray-500">
                                                        {(videoFile.size / 1024 / 1024).toFixed(2)} MB
                                                    </div>
                                                </div>
                                            </div>
                                            {/* „Éó„É¨„Éì„É•„ÉºÂãïÁîª */}
                                            <video
                                                ref={videoRef}
                                                src={videoUrl}
                                                className="w-full rounded-lg"
                                                loop
                                                playsInline
                                            />
                                        </div>

                                        <div className="grid grid-cols-3 gap-3 mb-4">
                                            <button
                                                onClick={togglePlay}
                                                className={`${isPlaying ? 'bg-orange-500 hover:bg-orange-600' : 'bg-green-500 hover:bg-green-600'} text-white rounded-xl p-4 flex flex-col items-center gap-2 transition-all transform hover:scale-105`}
                                            >
                                                <div className="w-8 h-8">{isPlaying ? <Pause /> : <Play />}</div>
                                                <span className="text-sm font-semibold">
                                                    {isPlaying ? '‰∏ÄÊôÇÂÅúÊ≠¢' : 'ÂÜçÁîü'}
                                                </span>
                                            </button>

                                            <button
                                                onClick={resetVideo}
                                                className="bg-blue-500 hover:bg-blue-600 text-white rounded-xl p-4 flex flex-col items-center gap-2 transition-all transform hover:scale-105"
                                            >
                                                <div className="w-8 h-8"><RotateCcw /></div>
                                                <span className="text-sm font-semibold">ÊúÄÂàù„Åã„Çâ</span>
                                            </button>

                                            <label className="bg-purple-500 hover:bg-purple-600 text-white rounded-xl p-4 flex flex-col items-center gap-2 cursor-pointer transition-all transform hover:scale-105">
                                                <div className="w-8 h-8"><Film /></div>
                                                <span className="text-sm font-semibold">Â§âÊõ¥</span>
                                                <input
                                                    type="file"
                                                    accept="video/*"
                                                    onChange={handleVideoSelect}
                                                    className="hidden"
                                                />
                                            </label>
                                        </div>

                                        {/* ÂÖ®ÁîªÈù¢Ë°®Á§∫„Éú„Çø„É≥ */}
                                        <button
                                            onClick={toggleDisplay}
                                            className="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl p-4 flex items-center justify-center gap-3 transition-all transform hover:scale-105 mb-4"
                                        >
                                            <div className="w-6 h-6"><Maximize /></div>
                                            <span className="font-bold text-lg">ÂÖ®ÁîªÈù¢Ë°®Á§∫ÔºàAirPlayÁî®Ôºâ</span>
                                        </button>
                                    </div>
                                )}
                            </div>

                            <div className="bg-white/90 rounded-2xl p-4 mb-4">
                                <div className="flex items-center justify-center gap-2 text-sm text-gray-600 mb-3">
                                    <div className="w-4 h-4"><Wifi /></div>
                                    <span>Êé•Á∂öÁä∂ÊÖã</span>
                                </div>
                                <div className={`p-3 rounded-lg text-center ${cameraConnected ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500'}`}>
                                    üì± „Çπ„Éû„ÉõBÔºà„Ç´„É°„É©Ôºâ {cameraConnected ? '‚úì Êé•Á∂öÊ∏à„Åø' : 'ÂæÖÊ©ü‰∏≠'}
                                </div>
                            </div>

                            <div className="bg-blue-50 border border-blue-200 rounded-2xl p-4 text-sm text-gray-700">
                                <strong>üì∫ AirPlay„ÅÆÊâãÈ†Ü:</strong><br/>
                                1. „ÄåÂÖ®ÁîªÈù¢Ë°®Á§∫„Äç„Éú„Çø„É≥„Çí„Çø„ÉÉ„Éó<br/>
                                2. „Ç≥„É≥„Éà„É≠„Éº„É´„Çª„É≥„Çø„Éº„ÇíÈñã„Åè<br/>
                                3. „ÄåÁîªÈù¢„Éü„É©„Éº„É™„É≥„Ç∞„Äç„Çí„Çø„ÉÉ„Éó<br/>
                                4. Apple TV/„ÉÜ„É¨„Éì„ÇíÈÅ∏Êäû
                            </div>
                        </div>
                    </div>
                );
            }

            // „Ç´„É°„É©ÂÖ•ÂäõÁîªÈù¢
            if (mode === 'camera-input') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-pink-500 to-rose-500 flex items-center justify-center p-8">
                        <div className="bg-white rounded-3xl shadow-2xl p-12 max-w-lg w-full">
                            <div className="text-center mb-8">
                                <div className="w-20 h-20 mx-auto mb-4 text-pink-500"><Camera /></div>
                                <h2 className="text-3xl font-bold text-gray-800 mb-2">üì± „Çπ„Éû„ÉõBÔºà„Ç´„É°„É©Ôºâ</h2>
                                <p className="text-gray-600">„Çπ„Éû„ÉõA„ÅÆ„É´„Éº„É†„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                            </div>

                            <div className="space-y-4">
                                <input
                                    type="text"
                                    placeholder="ABC123"
                                    value={inputRoomCode}
                                    onChange={(e) => {
                                        setInputRoomCode(e.target.value.toUpperCase());
                                        setConnectionError('');
                                    }}
                                    maxLength={6}
                                    className="w-full text-center text-3xl font-bold tracking-widest border-4 border-gray-300 rounded-2xl p-6 focus:outline-none focus:border-pink-500 uppercase"
                                />

                                {connectionError && (
                                    <div className="bg-red-100 text-red-700 rounded-xl p-4 text-center">
                                        {connectionError}
                                    </div>
                                )}

                                <button
                                    onClick={connectToRoomAsCamera}
                                    disabled={inputRoomCode.length !== 6}
                                    className="w-full bg-pink-500 hover:bg-pink-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-2xl p-6 text-xl font-bold transition-all transform hover:scale-105 disabled:transform-none"
                                >
                                    „Ç´„É°„É©„Å®„Åó„Å¶Êé•Á∂ö
                                </button>

                                <button
                                    onClick={() => {
                                        setMode('select');
                                        setInputRoomCode('');
                                        setConnectionError('');
                                    }}
                                    className="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-2xl p-4 transition-all"
                                >
                                    Êàª„Çã
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // „Ç´„É°„É©ÁîªÈù¢
            if (mode === 'camera') {
                return (
                    <div className="min-h-screen bg-black flex flex-col">
                        <div className="flex-1 relative flex items-center justify-center">
                            <video
                                ref={cameraVideoRef}
                                autoPlay
                                playsInline
                                muted
                                className="w-full h-full object-cover"
                                style={{ transform: 'scaleX(-1)' }}
                            />
                            <div className="absolute top-6 left-6 bg-pink-500 text-white px-6 py-3 rounded-full font-bold text-xl shadow-lg">
                                üì± „Ç´„É°„É©Ëµ∑Âãï‰∏≠
                            </div>
                            <div className="absolute bottom-6 left-6 right-6">
                                <div className="bg-black/70 text-white rounded-2xl p-4">
                                    <div className="flex items-center justify-between mb-2">
                                        <span className="text-sm">„É´„Éº„É†„Ç≥„Éº„Éâ</span>
                                        <span className="font-bold text-lg tracking-wider">{roomCode}</span>
                                    </div>
                                    <div className="flex items-center gap-2 text-sm text-green-400">
                                        <div className="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                                        <span>„Ç´„É°„É©Êò†ÂÉè„ÇíÈÄÅ‰ø°‰∏≠...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        };

        ReactDOM.render(<DancePracticeApp />, document.getElementById('root'));
    </script>
</body>
</html>
